<html>
  <head>
    <script>
      function accessPremiumContentGateway() {
        // TODO OGG: the domain name has to come from widget/snippet def
        var premiumContentGatewayUrl =
                'https://account.devdemic.com/premium-content-gateway';

        var isPremiumContentLocked = true;
        var urlPieces = window.location.href.split('?');
        for (var i = 0; i < urlPieces.length; i++) {
          if (urlPieces[i].indexOf('paydemic-locked=false') === 0) {
            isPremiumContentLocked = false;
            break;
          }
        }

        var referrer = document.referrer;
        console.log('Referrer: ', referrer);
        alert('ReferrerXXX: ' + referrer); // TODO OGG: remove
        if (isPremiumContentLocked && !referrer) {
          document.getElementsByTagName('body')[0].innerHTML =
            '<div style="color: #111; padding: 1rem;">Your browser is not supported.<br/>' +
            'Please try using a different one (e.g. Google Chrome, Mozilla Firefox, ...).<br/><br/>' +
            '<div style="background-color: #eee; padding: 1rem;">If using Apple Safari on iOS and using other browser is not an option,<br/>' +
            'please try setting ' +
            '<em style="font-weight: bold">Settings &gt; Safari &gt; Block Cookies</em> ' +
            'option to <em style="font-weight: bold">Always Allow</em><br/>' +
            'and then reload this page.</div></div>';
          document.body.style.display = 'block';
        } else {
          var hasExpectedReferrer =
            referrer && referrer.indexOf(premiumContentGatewayUrl) === 0;

          if (hasExpectedReferrer && !isPremiumContentLocked) {
            document.body.style.display = 'block';
          } else {
            document.getElementsByTagName('body')[0].innerHTML =
                    '<div>Checking purchase status ...</div>';
            document.body.style.display = 'block';

            var token = 'VM3NUVICABD37LGXIFNRF62OIQ'; // TODO OGG: this has to come prefilled from widget/snippet def
            console.log('Redirecting to Paydemic Premium Content Gateway ...');
            window.location.replace(premiumContentGatewayUrl + '/' + token);
          }
        }
      }
    </script>
  </head>

  <body onload="accessPremiumContentGateway();" style="display: none;">
    <div>
      Some Protected Content
    </div>
  </body>
</html>
